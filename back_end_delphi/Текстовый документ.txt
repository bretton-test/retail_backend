CREATE USER "TMP"  PROFILE "DEFAULT" IDENTIFIED BY "1" DEFAULT 
    TABLESPACE "USER_DATA" TEMPORARY 
    TABLESPACE "TEMPORARY_DATA" ACCOUNT UNLOCK;
GRANT DELETE ANY TABLE TO "TMP"
GRANT EXECUTE ANY PROCEDURE TO "TMP"
GRANT EXECUTE ANY TYPE TO "TMP"
GRANT INSERT ANY TABLE TO "TMP"
GRANT SELECT ANY SEQUENCE TO "TMP"
GRANT SELECT ANY TABLE TO "TMP" WITH ADMIN OPTION
GRANT UNLIMITED TABLESPACE TO "TMP" WITH ADMIN OPTION
GRANT UPDATE ANY TABLE TO "TMP"
GRANT "AQ_ADMINISTRATOR_ROLE" TO "TMP" WITH ADMIN OPTION;
GRANT "AQ_USER_ROLE" TO "TMP" WITH ADMIN OPTION;
GRANT "CONNECT" TO "TMP" WITH ADMIN OPTION;
GRANT "DBA" TO "TMP" WITH ADMIN OPTION;
GRANT "DELETE_CATALOG_ROLE" TO "TMP" WITH ADMIN OPTION;
GRANT "EXECUTE_CATALOG_ROLE" TO "TMP" WITH ADMIN OPTION;
GRANT "EXP_FULL_DATABASE" TO "TMP" WITH ADMIN OPTION;
GRANT "HS_ADMIN_ROLE" TO "TMP" WITH ADMIN OPTION;
GRANT "IMP_FULL_DATABASE" TO "TMP" WITH ADMIN OPTION;
GRANT "RECOVERY_CATALOG_OWNER" TO "TMP" WITH ADMIN OPTION;
GRANT "RESOURCE" TO "TMP" WITH ADMIN OPTION;
GRANT "SELECT_CATALOG_ROLE" TO "TMP" WITH ADMIN OPTION;
GRANT "SNMPAGENT" TO "TMP" WITH ADMIN OPTION;




CREATE TABLE "TMP"."TKATALOG"("PLU" NUMBER(13) NOT NULL,
			      "NAME" VARCHAR2(52) NOT NULL,
			      "ECRNAME" VARCHAR2(26),
			      "SHTUKA" NUMBER(1) DEFAULT 0 NOT NULL,
			      "WES" NUMBER(5, 3) DEFAULT 0 NOT NULL,
			      "ED_IZM" VARCHAR2(5) NOT NULL,
			      "KAT" NUMBER(3) DEFAULT 0 NOT NULL,
		     	      "PRICE" NUMBER(12, 3) DEFAULT 0,
			      "PROIZW" NUMBER(7) DEFAULT 0 NOT NULL,
			      "LIFE" NUMBER(3) DEFAULT 0 NOT NULL,
			      "KOLVO_V_MEST" NUMBER(3) DEFAULT 1 NOT NULL);
 
CREATE TABLE "TMP"."EDIZM"("ED_IZM" VARCHAR2(5) NOT NULL) ;



CREATE TABLE "TMP"."TBARCODE"("PLU" NUMBER(13) NOT NULL, 
    			      "BARCODE" VARCHAR2(13) NOT NULL) ;

CREATE TABLE "TMP"."TKAT"("KAT" NUMBER(3) NOT NULL,
			 "NAME" VARCHAR2(30) NOT NULL);



CREATE TABLE "TMP"."TPROIZW"("PROIZW" NUMBER(7) NOT NULL,
 			     "NAME" VARCHAR2(30),
			      "STRANA" VARCHAR2(30));
  




ALTER TABLE "TMP"."KNIGA" 
    ADD("SUM" NUMBER(9, 3) DEFAULT 0 NOT NULL);

ALTER TABLE "TMP"."KNIGA" 
    ADD("PARTOST" NUMBER(9, 3) DEFAULT 0 NOT NULL);


create or replace view tmp.journal as
select k.plu,
nvl(t.name,'?') name,
k.nom,
k.skladid  sklad,      
k.data,
k.cena,
nvl(jp.nn,rj.nn) prnom,
sum(k.prihod) prihod,sum(k.rashod) rashod,k.ostatok
from tmp.kniga k,tmp.tkatalog t,tmp.tprihj jp,tmp.trashj rj
where jp.nom(+)=k.nom 
and rj.nom(+)=k.nom 
and t.plu(+)=k.plu
and k.otkat=0
group by K.plu,t.name,t.kat,k.nom,k.ostatok,k.data,k.cena,nvl(jp.nn,rj.nn),k.skladid 
union all
select k.plu,
nvl(t.name,'?') name,
0  nom,
k.skladid  sklad,      
sysdate  data,
0  cena,
0 prnom,
sum(k.prihod) prihod,sum(k.rashod) rashod,sum(k.partost) ostatok
from tmp.kniga k,tmp.tkatalog t
where  t.plu(+)=k.plu
and k.otkat=0
group by K.plu,t.name,t.kat,k.skladid;


CREATE TABLE "TMP".TPART (plu NUMBER(13,0) DEFAULT 0 NOT NULL,
nom NUMBER(12,0) DEFAULT 0 NOT NULL,
cenazak NUMBER(12,2) DEFAULT 0 NOT NULL,
cenareal NUMBER(12,2) DEFAULT 0 NOT NULL,
kolvo NUMBER(9,3) DEFAULT 0 NOT NULL, 
data DATE DEFAULT sysdate NOT NULL,
id NUMBER(12,0) DEFAULT 0 NOT NULL,  PRIMARY KEY (id)) ;

CREATE SEQUENCE "TMP"."PARTWORKSEQ" INCREMENT BY 1 
NOMAXVALUE MINVALUE 1 NOCYCLE CACHE 20 NOORDER;

CREATE OR REPLACE TRIGGER "TMP".partwtrig BEFORE INSERT ON "TMP"."TPART" 
REFERENCING OLD AS OLD NEW AS NEW FOR EACH ROW 
DECLARE X  NUMBER;
BEGIN
SELECT PARTWORKSEQ.NEXTVAL INTO X FROM DUAL;
:NEW.ID:=X;
END;

nomrash.tpart
